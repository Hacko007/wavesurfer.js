"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,markerWidth:1,skipLength:2,minPxPerSec:1,samples:3,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,normalize:!1,audioContext:null,container:null,renderer:"Canvas"},init:function(e){this.params=WaveSurfer.util.extend({},this.defaultParams,e),this.markers={},this.once("marked",this.bindMarks.bind(this)),this.savedVolume=0,this.isMuted=!1,this.createBackend(),this.createDrawer()},createDrawer:function(){var e=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.params),this.drawer.on("redraw",function(){e.drawBuffer()}),this.drawer.on("click",function(t){e.seekTo(t)}),this.on("progress",function(t){e.drawer.progress(t)})},createBackend:function(){var e=this;this.backend=Object.create(WaveSurfer.WebAudio),this.backend.on("play",function(){e.fireEvent("play")}),this.backend.on("ready",function(){e.clearMarks(),e.drawBuffer(),e.fireEvent("ready")}),this.on("play",function(){e.restartAnimationLoop()}),this.backend.init(this.params)},restartAnimationLoop:function(){var e=this,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=function(){e.fireEvent("progress",e.backend.getPlayedPercents()),e.backend.isPaused()||t(i)};i()},playAt:function(e){this.backend.play(this.backend.getDuration()*e)},play:function(){this.backend.play()},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(e){this.skip(e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.timings(e),i=t[0]/t[1];this.seekTo(i)},seekTo:function(e){var t=this.backend.isPaused();this.playAt(e),t&&this.pause(),this.fireEvent("seek",e)},stop:function(){this.playAt(0),this.pause(),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},mark:function(e){if(e.id&&e.id in this.markers)return this.markers[e.id].update(e);var t=this,i=WaveSurfer.util.extend({id:WaveSurfer.util.getId(),position:this.backend.getCurrentTime(),width:this.params.markerWidth},e),r=Object.create(WaveSurfer.Mark);return r.on("update",function(){var e=t.backend.getDuration()||1;null==r.position&&(r.position=r.percentage*e),r.percentage=r.position/e,t.markers[r.id]=r,t.drawer.addMark(r)}),r.on("remove",function(){t.drawer.removeMark(r),delete t.markers[r.id]}),this.fireEvent("marked",r),r.init(i)},redrawMarks:function(){Object.keys(this.markers).forEach(function(e){var t=this.markers[e];this.drawer.addMark(t)},this)},clearMarks:function(){Object.keys(this.markers).forEach(function(e){this.markers[e].remove()},this)},timings:function(e){var t=this.backend.getCurrentTime()||0,i=this.backend.getDuration()||1;return t=Math.max(0,Math.min(i,t+(e||0))),[t,i]},drawBuffer:function(){if(this.drawer.clear(),this.drawer.progress(this.backend.getPlayedPercents()),this.redrawMarks(),this.params.fillParent&&!this.params.scrollParent)var e=this.drawer.getWidth();else e=this.backend.getDuration()*this.params.minPxPerSec;var t=this.backend.getPeaks(e);this.drawer.drawPeaks(t,e)},loadBuffer:function(e){this.pause(),this.backend.loadBuffer(e)},onProgress:function(e){if(e.lengthComputable)var t=e.loaded/e.total;else t=e.loaded/(e.loaded+1e6);this.fireEvent("loading",Math.round(100*t),e.target)},load:function(e){this.backend.renderMedia(e)},loadAjax:function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e,!0),i.send(),i.responseType="arraybuffer",i.addEventListener("progress",function(e){t.onProgress(e)}),i.addEventListener("load",function(){200==i.status?t.loadBuffer(i.response):t.fireEvent("error","Server response: "+i.statusText)}),i.addEventListener("error",function(){t.fireEvent("error","Error loading audio")}),this.empty()},bindDragNDrop:function(e){var t=this,i=new FileReader;i.addEventListener("progress",function(e){t.onProgress(e)}),i.addEventListener("load",function(e){t.loadBuffer(e.target.result)}),i.addEventListener("error",function(){t.fireEvent("error","Error reading file")}),"string"==typeof e&&(e=document.querySelector(e));var r="wavesurfer-dragover";e.addEventListener("drop",function(s){s.stopPropagation(),s.preventDefault(),e.classList.remove(r);var a=s.dataTransfer.files[0];a?(t.empty(),i.readAsArrayBuffer(a)):t.fireEvent("error","Not a file")}),e.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),e.classList.add(r)}),e.addEventListener("dragleave",function(t){t.stopPropagation(),t.preventDefault(),e.classList.remove(r)})},bindMarks:function(){var e=this,t=0;this.backend.on("play",function(){Object.keys(e.markers).forEach(function(t){e.markers[t].played=!1})}),this.backend.on("audioprocess",function(i){Object.keys(e.markers).forEach(function(r){var s=e.markers[r];s.played||s.position<=i&&s.position>=t&&(s.played=!0,e.fireEvent("mark",s),s.fireEvent("reached"))}),t=i})},empty:function(){this.pause(),this.clearMarks(),this.backend.loadEmpty(),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}};WaveSurfer.Mark={defaultParams:{id:null,position:0,percentage:0,width:1,color:"#333"},init:function(e){return this.update(WaveSurfer.util.extend({},this.defaultParams,e))},getTitle:function(){var e=new Date(1e3*this.position);return e.getMinutes()+":"+e.getSeconds()},update:function(e){return Object.keys(e).forEach(function(t){t in this.defaultParams&&(this[t]=e[t])},this),null==e.position&&null!=e.percentage&&(this.position=null),this.fireEvent("update"),this},remove:function(){this.fireEvent("remove")}},WaveSurfer.Observer={on:function(e,t){this.handlers||(this.handlers={});var i=this.handlers[e];i||(i=this.handlers[e]=[]),i.push(t)},un:function(e,t){if(this.handlers){var i=this.handlers[e];if(i)if(t)for(var r=i.length-1;r>=0;r--)i[r]==t&&i.splice(r,1);else i.length=0}},once:function(e,t){var i=function(){t(),this.un(e,i)}.bind(this);this.on(e,i)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],i=Array.prototype.slice.call(arguments,1);if(t)for(var r=0,s=t.length;s>r;r+=1)t[r].apply(null,i)}}},WaveSurfer.util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){null!=t&&Object.keys(t).forEach(function(i){e[i]=t[i]})}),e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(e){for(var t=-1/0,i=0,r=e.length;r>i;i++){var s=e[i];s>t&&(t=s)}return t}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.util.extend(WaveSurfer.Mark,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,init:function(e){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("wavesurfer.js: your browser doesn't support WebAudio");this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.offlineAc=this.getOfflineAudioContext(this.ac.sampleRate),this.createVolumeNode(),this.createScriptNode()},setFilter:function(e){this.filterNode&&this.filterNode.disconnect(),this.gainNode.disconnect(),e?(e.connect(this.ac.destination),this.gainNode.connect(e)):this.gainNode.connect(this.ac.destination),this.filterNode=e},createScriptNode:function(){var e=this,t=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(t):this.ac.createJavaScriptNode(t),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){if(!e.isPaused()){var t=e.getCurrentTime();t>e.scheduledPause&&e.pause(),e.fireEvent("audioprocess",t)}}},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},clearSource:function(){this.source.disconnect(),this.source=null},refreshBufferSource:function(){this.source&&this.clearSource(),this.source=this.ac.createBufferSource(),this.buffer&&(this.source.buffer=this.buffer),this.source.connect(this.gainNode)},setBuffer:function(e){this.lastPause=0,this.lastStart=0,this.startTime=0,this.paused=!0,this.buffer=e},loadBuffer:function(e){var t=this;this.offlineAc.decodeAudioData(e,function(e){t.setBuffer(e),t.fireEvent("ready")},function(){t.fireEvent("error","Error decoding audio")})},renderMedia:function(e){var t=this,i=this.getAudioElement(e);i.addEventListener("canplay",function(){var e=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,i.duration*t.ac.sampleRate,t.ac.sampleRate),r=e.createMediaElementSource(i);r.connect(e.destination),e.startRendering(),e.addEventListener("complete",function(e){r.disconnect(),t.setBuffer(e.renderedBuffer),t.fireEvent("ready")}),i.play()})},getAudioElement:function(e){var t=new Audio;return t.autoplay=!1,t.src=e,t},loadEmpty:function(){this.setBuffer(null)},isPaused:function(){return this.paused},getDuration:function(){return this.buffer?this.buffer.duration:0},play:function(e,t){this.refreshBufferSource(),null==e&&(e=this.getCurrentTime()),null==t&&(t=this.getDuration()),e>t&&(e=0),this.lastStart=e,this.startTime=this.ac.currentTime,this.paused=!1,this.scheduledPause=t,this.source.start?this.source.start(0,e,t-e):this.source.noteGrainOn(0,e,t-e),this.fireEvent("play")},pause:function(){this.lastPause=this.lastStart+(this.ac.currentTime-this.startTime),this.paused=!0,this.source&&(this.source.stop?this.source.stop(0):this.source.noteOff(0),this.clearSource()),this.fireEvent("pause")},getPeaks:function(e,t){var i=this.buffer,r=Math.ceil(i.length/e);t=t||~~(r/10);for(var s=i.numberOfChannels,a=new Float32Array(e),n=0;s>n;n++)for(var o=i.getChannelData(n),h=0;e>h;h++){for(var c=~~(h*r),u=c+r,d=0,f=c;u>f;f+=t){var l=o[f];l>d?d=l:-l>d&&(d=-l)}n>1?a[h]+=d/s:a[h]=d/s}return a},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},getCurrentTime:function(){return this.isPaused()?this.lastPause:this.lastStart+(this.ac.currentTime-this.startTime)},audioContext:null,getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},offlineAudioContext:null,getOfflineAudioContext:function(e){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),WaveSurfer.WebAudio.offlineAudioContext}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.Drawer={init:function(e){if(this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw new Error("wavesurfer.js: container element not found");if(this.params=e,this.pixelRatio=this.params.pixelRatio,this.width=0,this.height=e.height*this.pixelRatio,this.containerWidth=this.container.clientWidth,this.lastPos=0,this.createWrapper(),this.createElements(),this.params.fillParent){var t=this;window.addEventListener("resize",function(){t.container.clientWidth!=t.containerWidth&&t.fireEvent("redraw")})}},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.scrollParent?"scroll":"hidden",overflowY:"hidden"});var e=this;this.wrapper.addEventListener("click",function(t){t.preventDefault();var i="offsetX"in t?t.offsetX:t.layerX;e.fireEvent("click",i/e.scrollWidth||0)})},clear:function(){this.resetScroll(),this.clearWave()},drawPeaks:function(e,t){if(this.setWidth(t),this.params.normalize)var i=WaveSurfer.util.max(e);else i=1;this.drawWave(e,i)},style:function(e,t){Object.keys(t).forEach(function(i){e.style[i]=t[i]})},resetScroll:function(){this.wrapper.scrollLeft=0},recenter:function(e){var t=this.containerWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var i=this.wrapper.scrollLeft,r=~~(this.containerWidth/2),s=e-r,a=s-i;if(!t&&a>=-r&&r>a){var n=5;a=Math.max(-n,Math.min(n,a)),s=i+a}0!=a&&(this.wrapper.scrollLeft=s)},getWidth:function(){return this.containerWidth*this.pixelRatio},setWidth:function(e){e!=this.width&&(this.width=e,this.scrollWidth=~~(this.width/this.pixelRatio),this.containerWidth=this.container.clientWidth,this.params.fillParent||this.params.scrollParent||this.style(this.wrapper,{width:this.scrollWidth+"px"}),this.updateWidth())},progress:function(e){var t=1/this.pixelRatio,i=Math.round(e*this.width)*t;(i<this.lastPos||i-this.lastPos>=t)&&(this.lastPos=i,this.params.scrollParent&&this.recenterOnPosition(~~(this.scrollWidth*e)),this.updateProgress(e))},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){},addMark:function(){},removeMark:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){this.marks={};var e=this.wrapper.appendChild(document.createElement("canvas"));this.style(e,{position:"absolute",zIndex:1});var t=this.wrapper.appendChild(document.createElement("wave"));this.style(t,{position:"absolute",zIndex:2,overflow:"hidden",width:"0",borderRight:[this.params.cursorWidth+"px","solid",this.params.cursorColor].join(" ")});var i=t.appendChild(document.createElement("canvas")),r=this.wrapper.appendChild(document.createElement("canvas"));this.style(r,{position:"absolute",zIndex:3}),this.canvases=[e,i,r],this.waveCc=e.getContext("2d"),this.progressCc=i.getContext("2d"),this.progressWave=t,this.marksCc=r.getContext("2d")},updateWidth:function(){var e=Math.round(this.width/this.pixelRatio)+"px";this.canvases.forEach(function(t){t.width=this.width,t.height=this.height,t.style.width=e},this),this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(e,t){this.waveCc.fillStyle=this.params.waveColor,this.progressCc.fillStyle=this.params.progressColor;var i=this.height/t,r=this.height/2;this.waveCc.beginPath(),this.waveCc.moveTo(0,r),this.progressCc.beginPath(),this.progressCc.moveTo(0,r);for(var s=0;s<this.width;s++){var a=Math.round(e[s]*i)||1;this.waveCc.lineTo(s,r+a),this.progressCc.lineTo(s,r+a)}this.waveCc.lineTo(this.width,r),this.progressCc.lineTo(this.width,r),this.waveCc.moveTo(0,r),this.progressCc.moveTo(0,r);for(var s=0;s<this.width;s++){var a=Math.round(e[s]*i)||1;this.waveCc.lineTo(s,r-a),this.progressCc.lineTo(s,r-a)}this.waveCc.lineTo(this.width,r),this.waveCc.fill(),this.progressCc.lineTo(this.width,r),this.progressCc.fill()},updateProgress:function(e){var t=Math.round(this.width*e)/this.pixelRatio;this.progressWave.style.width=t+"px"},addMark:function(e){var t=e.id in this.marks;this.marks[e.id]=e,t?this.redrawMarks():this.drawMark(e)},removeMark:function(e){delete this.marks[e.id],this.redrawMarks()},drawMark:function(e){this.marksCc.fillStyle=e.color;var t=Math.min(this.width-e.width,Math.max(0,Math.round(e.percentage*this.width-e.width/2)));this.marksCc.fillRect(t,0,e.width,this.height)},redrawMarks:function(){this.marksCc.clearRect(0,0,this.width,this.height),Object.keys(this.marks).forEach(function(e){this.drawMark(this.marks[e])},this)}});
//# sourceMappingURL=/build/wavesurfer-js-map.json